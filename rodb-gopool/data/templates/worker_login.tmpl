{{/* Worker login template */}}
<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="icon" type="image/png" sizes="64x64" href="/favicon.png">
	<meta charset="UTF-8">
	<title>{{if .BrandDomain}}{{.BrandDomain}}{{else}}{{.BrandName}}{{end}} Worker Login</title>
	<link rel="stylesheet" href="/style.css">
</head>
<body>
	{{template "header" .}}
	<div class="page">
		{{if .ClerkEnabled}}
		<div class="card login-card">
			<div class="login-card-header">
				<span class="login-card-badge">New Feature!</span>
				<h2>Personal Worker Dashboard</h2>
			</div>
			<p class="text-sm login-card-description">
				Sign in with Google to unlock a dedicated dashboard for all your workers!
			</p>
			<a class="btn btn-highlight" href="/sign-in?redirect=/saved-workers">Sign in</a>
		</div>
		{{end}}
		<div class="card worker-lookup-card">
			<div class="lookup-card-header">
				<h2>Quick Worker & Wallet Lookup</h2>
				<p class="text-sm lookup-card-description">
					Enter a wallet.worker-name to view worker stats or a wallet address to list every active worker mining to it.
				</p>
			</div>
			<form method="get" action="/worker/sha256" id="workerLookupForm">
				<div class="label">Worker ID</div>
				<div class="input-row">
					<input class="input" type="text" id="workerInput" placeholder="walletName.workerName">
					<input type="hidden" name="hash" id="workerHash">
					<button class="btn" type="submit">Search worker</button>
				</div>
				<p class="text-sm lookup-card-footnote">
					Use the exact wallet.worker-name shown in your miner configuration.
				</p>
			</form>
			<hr style="margin:24px 0;border-top:1px solid var(--card-border);">
			<form method="get" action="/worker/search" id="walletLookupForm">
				<div class="label">Wallet address</div>
				<div class="input-row">
					<input class="input" type="text" id="walletInput" placeholder="Wallet address (e.g. bc1...)" autocomplete="off">
					<input type="hidden" name="hash" id="walletHash">
					<button class="btn" type="submit">Search wallet</button>
				</div>
			</form>
			{{if .Error}}
				<p class="text-sm" style="color:#f88d8d; margin-top:10px;">{{.Error}}</p>
			{{end}}
		</div>

		{{template "footer" .}}
	</div>
	<script>
	// SHA256 implementation for client-side hashing
	async function sha256(str) {
		try {
			const buffer = new TextEncoder().encode(str);
			const hashBuffer = await crypto.subtle.digest('SHA-256', buffer);
			const hashArray = Array.from(new Uint8Array(hashBuffer));
			return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
		} catch (error) {
			console.error('SHA256 error:', error);
			alert('Error: Secure context (HTTPS) required for client-side hashing. Please contact the pool administrator.');
			throw error;
		}
	}

	// Handle worker lookup form submission
	document.getElementById('workerLookupForm').addEventListener('submit', async function(e) {
		e.preventDefault();
		const workerInput = document.getElementById('workerInput').value.trim();
		if (!workerInput) {
			alert('Please enter a worker name');
			return;
		}
		try {
			// Hash the worker name
			const hash = await sha256(workerInput);
			document.getElementById('workerHash').value = hash;
			// Submit the form
			this.submit();
		} catch (error) {
			console.error('Form submission error:', error);
			}
		});
		document.getElementById('walletLookupForm').addEventListener('submit', async function(e) {
			e.preventDefault();
			const walletInput = document.getElementById('walletInput').value.trim();
			if (!walletInput) {
				alert('Please enter a wallet address');
				return;
			}
			try {
				const hash = await sha256(walletInput);
				document.getElementById('walletHash').value = hash;
				this.submit();
			} catch (error) {
				console.error('Wallet form submission error:', error);
			}
		});
	</script>
</body>
</html>
