{{/* Admin control panel template */}}
{{define "restart-required"}}<span class="restart-required">&#x21bb;</span>{{end}}
{{define "sensitive"}}<span class="sensitive">[PROTECTED]</span>{{end}}
{{define "admin-nav"}}
<div class="admin-tabs">
	<a class="admin-tab {{if eq .AdminSection "settings"}}active{{end}}" href="/admin">Live settings</a>
	<a class="admin-tab {{if eq .AdminSection "miners"}}active{{end}}" href="/admin/miners">Connected miners</a>
	<a class="admin-tab {{if eq .AdminSection "logins"}}active{{end}}" href="/admin/logins">Accounts</a>
	<a class="admin-tab {{if eq .AdminSection "bans"}}active{{end}}" href="/admin/bans">Bans</a>
	<a class="admin-tab {{if eq .AdminSection "operator"}}active{{end}}" href="/admin/operator">Operator stats</a>
	<a class="admin-tab {{if eq .AdminSection "logs"}}active{{end}}" href="/admin/logs">Logs</a>
</div>
{{end}}
<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="icon" type="image/png" sizes="64x64" href="/favicon.png">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{{if .BrandDomain}}{{.BrandDomain}}{{else}}{{.BrandName}}{{end}} - Admin Control Panel</title>
	<link rel="stylesheet" href="/style.css">
</head>
<body>
	{{template "header" .}}
	<main class="page admin-page" id="content">
		<h1>Admin Control Panel</h1>
		<p class="text-sm" style="margin-top:4px;">
			This panel is not linked anywhere else and is hidden until you configure <span class="mono">data/config/admin.toml</span>.
			Keep the file private and only enable the panel on trusted networks.
		</p>

		{{if .AdminNotice}}
		<div class="card">
			<p class="text-sm">{{.AdminNotice}}</p>
		</div>
		{{end}}

		{{if not .AdminEnabled}}
		<div class="card">
			<p class="text-sm">
				The admin UI is disabled. Enable it by editing
				<span class="mono">{{.AdminConfigPath}}</span> and setting <span class="mono">enabled = true</span>.
				Change the default credentials before reloading the page.
			</p>
		</div>
		{{else if not .LoggedIn}}
		<div class="card">
			<div class="label">Sign in</div>
			{{if .AdminLoginError}}
			<p class="text-sm" style="color:#f88d8d;">{{.AdminLoginError}}</p>
			{{end}}
			<form method="post" action="/admin/login">
				<label class="label" for="admin-username">Username</label>
				<input id="admin-username" name="username" type="text" class="textfield" autocomplete="username" required>
				<label class="label" for="admin-password">Password</label>
				<input id="admin-password" name="password" type="password" class="textfield" autocomplete="current-password" required>
				<button class="btn" type="submit" style="margin-top:12px;">Unlock admin panel</button>
			</form>
		</div>
		{{else}}
		{{template "admin-nav" .}}
		<div class="card">
				<div class="label">Live settings</div>
				<p class="text-sm" style="margin:4px 0 10px 0;">
					This updates goPool's in-memory configuration immediately. Some settings (listeners, Stratum behavior) still require a reboot to fully take effect.
					Each field includes a note with extra detail. {{template "restart-required" .}} indicates a restart is required.
					Fields marked <span class="sensitive">[PROTECTED]</span> are intentionally read-only for security and can only be changed in config files.
					Most day-to-day operators only need the visible section below; the rest is under Advanced settings.
				</p>
				{{if .AdminApplyError}}
				<p class="text-sm" style="color:#f88d8d;">{{.AdminApplyError}}</p>
				{{end}}
			<form method="post" action="/admin/apply">
				<h3 style="margin:0 0 8px 0;">Branding</h3>
				<div class="grid admin-grid">
					<div>
						<div class="label">Tagline<div class="label-note">Short one-line description shown on the overview page.</div></div>
						<input name="status_tagline" type="text" class="textfield" value="{{.Settings.StatusTagline}}">
					</div>
					<div>
						<div class="label">Connect miner title extra<div class="label-note">Extra headline shown in the Connect Miner panel (optional).</div></div>
						<input name="status_connect_miner_title_extra" type="text" class="textfield" value="{{.Settings.StatusConnectMinerTitleExtra}}">
					</div>
					<div>
						<div class="label">Connect miner title URL<div class="label-note">Optional link associated with the connect miner headline.</div></div>
						<input name="status_connect_miner_title_extra_url" type="text" class="textfield" value="{{.Settings.StatusConnectMinerTitleExtraURL}}">
					</div>
					<div>
						<div class="label">Fiat currency<div class="label-note">Fiat currency code used for price conversions (e.g. usd, eur).</div></div>
						<input name="fiat_currency" type="text" class="textfield" value="{{.Settings.FiatCurrency}}">
					</div>
					<div>
						<div class="label">GitHub URL<div class="label-note">Link shown in the header (optional).</div></div>
						<input name="github_url" type="text" class="textfield" value="{{.Settings.GitHubURL}}">
					</div>
					<div>
						<div class="label">Discord URL<div class="label-note">Link shown in the header (optional).</div></div>
						<input name="discord_url" type="text" class="textfield" value="{{.Settings.DiscordURL}}">
					</div>
					<div>
						<div class="label">Mempool address URL<div class="label-note">Explorer base URL used to build address links (defaults to mempool.space).</div></div>
						<input name="mempool_address_url" type="text" class="textfield" value="{{.Settings.MempoolAddressURL}}">
					</div>
					<div>
						<div class="label">Pool donation address<div class="label-note">Optional donation address shown in the footer.</div></div>
						<input name="pool_donation_address" type="text" class="textfield" value="{{.Settings.PoolDonationAddress}}">
					</div>
				</div>

				<details class="admin-protected" style="margin-top:16px;">
					<summary class="admin-protected-summary">
						<span class="admin-protected-title">Advanced settings</span>
						<span class="admin-protected-hint">Click to expand</span>
					</summary>
					<p class="text-sm" style="margin:8px 0 8px 0;">
						Limits, protocol/runtime tuning, ban thresholds, and protected read-only config values.
					</p>

				<h3 style="margin:18px 0 8px 0;">Limits</h3>
				<p class="text-sm" style="margin:0 0 8px 0;">
					These controls affect how quickly new miner connections are accepted and how much reconnect pressure the pool will tolerate after restarts.
				</p>
				<div class="grid admin-grid">
					<div>
						<div class="label">max_conns {{template "restart-required" .}}<div class="label-note">Maximum simultaneous Stratum connections allowed (checked on accept).</div></div>
						<input name="max_conns" type="number" min="10" max="1000000" class="textfield" value="{{.Settings.MaxConns}}">
					</div>
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="disable_connect_rate_limits" value="1" {{if .Settings.DisableConnectRateLimits}}checked{{end}}><span>disable_connect_rate_limits {{template "restart-required" .}}</span></label><div class="label-note">Disable connect/accept rate limiting entirely (intended for local-only pools on trusted networks).</div></div>
					</div>
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="auto_accept_rate_limits" value="1" {{if .Settings.AutoAcceptRateLimits}}checked{{end}}><span>auto_accept_rate_limits {{template "restart-required" .}}</span></label><div class="label-note">When enabled, goPool auto-computes accept throttles from max_conns on startup (overrides explicit accept_* values; ignored when disable_connect_rate_limits is enabled).</div></div>
					</div>
					<div>
						<div class="label">max_accepts_per_second {{template "restart-required" .}}<div class="label-note">Connection accept throttle (accepts/sec) for the initial restart/reconnect window.</div></div>
						<input name="max_accepts_per_second" type="number" min="1" max="100000" class="textfield" value="{{.Settings.MaxAcceptsPerSecond}}">
					</div>
					<div>
						<div class="label">max_accept_burst {{template "restart-required" .}}<div class="label-note">Burst size for accept limiter (token bucket). Allows short spikes.</div></div>
						<input name="max_accept_burst" type="number" min="1" max="500000" class="textfield" value="{{.Settings.MaxAcceptBurst}}">
					</div>
					<div>
						<div class="label">accept_reconnect_window {{template "restart-required" .}}<div class="label-note">Target seconds for all miners to reconnect after a restart (used for auto_accept_rate_limits).</div></div>
						<input name="accept_reconnect_window" type="number" class="textfield" value="{{.Settings.AcceptReconnectWindow}}">
					</div>
					<div>
						<div class="label">accept_burst_window {{template "restart-required" .}}<div class="label-note">Initial burst window (seconds) after restart (used for auto_accept_rate_limits).</div></div>
						<input name="accept_burst_window" type="number" class="textfield" value="{{.Settings.AcceptBurstWindow}}">
					</div>
					<div>
						<div class="label">accept_steady_state_window {{template "restart-required" .}}<div class="label-note">Seconds after startup before switching accept throttles to steady-state.</div></div>
						<input name="accept_steady_state_window" type="number" class="textfield" value="{{.Settings.AcceptSteadyStateWindow}}">
					</div>
					<div>
						<div class="label">accept_steady_state_rate {{template "restart-required" .}}<div class="label-note">Accepts/sec limit once steady-state mode activates.</div></div>
						<input name="accept_steady_state_rate" type="number" class="textfield" value="{{.Settings.AcceptSteadyStateRate}}">
					</div>
					<div>
						<div class="label">steady_state_reconnect_percent {{template "restart-required" .}}<div class="label-note">Expected % of miners reconnecting during normal operation (used for auto_accept_rate_limits).</div></div>
						<input name="accept_steady_state_reconnect_percent" type="text" class="textfield" value="{{printf "%.4f" .Settings.AcceptSteadyStateReconnectPercent}}">
					</div>
					<div>
						<div class="label">steady_state_reconnect_window {{template "restart-required" .}}<div class="label-note">Seconds to spread expected steady-state reconnects across (used for auto_accept_rate_limits).</div></div>
						<input name="accept_steady_state_reconnect_window" type="number" class="textfield" value="{{.Settings.AcceptSteadyStateReconnectWindow}}">
					</div>
					<div>
						<div class="label">stratum_messages_per_minute<div class="label-note">Per-connection Stratum message cap per minute (0 disables; otherwise minimum 10). Applies to connected miners on live apply.</div></div>
						<input name="stratum_messages_per_minute" type="number" min="0" max="1000000" class="textfield" value="{{.Settings.StratumMessagesPerMinute}}">
					</div>
					<div>
						<div class="label">max_recent_jobs<div class="label-note">Recent job IDs cached per miner for stale-share handling and duplicate checks. Fully applies to new connections; live apply updates the limit for existing connections but does not resize existing caches.</div></div>
						<input name="max_recent_jobs" type="number" min="8" max="10000" class="textfield" value="{{.Settings.MaxRecentJobs}}">
					</div>
				</div>

				<h3 style="margin:18px 0 8px 0;">Difficulty</h3>
				<p class="text-sm" style="margin:0 0 8px 0;">
					These settings control VarDiff behavior and share cadence, which directly affects miner submit frequency, stale rate, and pool-side load.
				</p>
				<div class="grid admin-grid">
					<div>
						<div class="label">min_difficulty<div class="label-note">Minimum VarDiff target difficulty for miner connections (0 disables the minimum clamp). Applies on live apply.</div></div>
						<input name="min_difficulty" type="text" class="textfield" value="{{printf "%.8f" .Settings.MinDifficulty}}">
					</div>
					<div>
						<div class="label">max_difficulty<div class="label-note">Maximum VarDiff target difficulty for miner connections (0 disables the maximum clamp). Applies on live apply.</div></div>
						<input name="max_difficulty" type="text" class="textfield" value="{{printf "%.8f" .Settings.MaxDifficulty}}">
					</div>
					<div>
						<div class="label">default_difficulty<div class="label-note">Starting difficulty before VarDiff has enough evidence (0 uses min_difficulty). Applies to new connections; existing miners keep their current assigned difficulty.</div></div>
						<input name="default_difficulty" type="text" class="textfield" value="{{printf "%.8f" .Settings.DefaultDifficulty}}">
					</div>
					<div>
						<div class="label">target_shares_per_min<div class="label-note">VarDiff target share cadence in shares per minute. Applies on live apply.</div></div>
						<input name="target_shares_per_min" type="number" min="0.1" max="120" step="0.1" class="textfield" value="{{printf "%.4f" .Settings.TargetSharesPerMin}}">
					</div>
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="vardiff_enabled" value="1" {{if .Settings.VarDiffEnabled}}checked{{end}}><span>vardiff_enabled</span></label><div class="label-note">Enable automatic difficulty retargeting. Disable to keep connection difficulty static unless explicitly changed. Applies on live apply.</div></div>
					</div>
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="lock_suggested_difficulty" value="1" {{if .Settings.LockSuggestedDifficulty}}checked{{end}}><span>lock_suggested_difficulty</span></label><div class="label-note">When enabled, the first mining.suggest_difficulty / mining.suggest_target locks that connection to the suggested difficulty (disables VarDiff). Applies on live apply.</div></div>
					</div>
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="enforce_suggested_difficulty_limits" value="1" {{if .Settings.EnforceSuggestedDifficultyLimits}}checked{{end}}><span>enforce_suggested_difficulty_limits</span></label><div class="label-note">Reject/ban suggested difficulties outside configured min/max bounds. Applies on live apply.</div></div>
					</div>
					<div>
						<div class="label">difficulty_step_granularity<div class="label-note">Difficulty quantization granularity for mining.set_difficulty (1=power-of-two, 2=half, 3=third, 4=quarter). Applies on live apply.</div></div>
						<input name="difficulty_step_granularity" type="number" min="1" class="textfield" value="{{.Settings.DifficultyStepGranularity}}">
					</div>
				</div>

				<h3 style="margin:18px 0 8px 0;">Bans</h3>
				<p class="text-sm" style="margin:0 0 8px 0;">
					These protections decide when noisy or abusive miners/hosts are temporarily blocked to protect pool stability.
				</p>
				<div class="grid admin-grid">
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="clean_expired_on_startup" value="1" {{if .Settings.CleanExpiredBansOnStartup}}checked{{end}}><span>clean_expired_on_startup {{template "restart-required" .}}</span></label><div class="label-note">When enabled, expired bans are removed from disk at startup (startup-only).</div></div>
					</div>
					<div>
						<div class="label">ban_invalid_submissions_after<div class="label-note">Ban a worker after this many invalid submissions within the window (minimum 3). Applies on live apply.</div></div>
						<input name="ban_invalid_submissions_after" type="number" min="3" max="10000" class="textfield" value="{{.Settings.BanInvalidSubmissionsAfter}}">
					</div>
					<div>
						<div class="label">ban_invalid_submissions_window_seconds<div class="label-note">Window size (seconds) for invalid submission counting. Applies on live apply.</div></div>
						<input name="ban_invalid_submissions_window_seconds" type="number" min="10" max="86400" class="textfield" value="{{.Settings.BanInvalidSubmissionsWindowSeconds}}">
					</div>
					<div>
						<div class="label">ban_invalid_submissions_duration_seconds<div class="label-note">Ban duration (seconds) once the invalid threshold is hit. Applies on live apply.</div></div>
						<input name="ban_invalid_submissions_duration_seconds" type="number" min="10" max="604800" class="textfield" value="{{.Settings.BanInvalidSubmissionsDurationSeconds}}">
					</div>
					<div>
						<div class="label">reconnect_ban_threshold<div class="label-note">Ban a host after this many reconnects within the window (minimum 3). Applies to new reconnect events immediately.</div></div>
						<input name="reconnect_ban_threshold" type="number" min="3" max="10000" class="textfield" value="{{.Settings.ReconnectBanThreshold}}">
					</div>
					<div>
						<div class="label">reconnect_ban_window_seconds<div class="label-note">Reconnect ban counting window (seconds). Applies to new reconnect events immediately.</div></div>
						<input name="reconnect_ban_window_seconds" type="number" min="10" max="86400" class="textfield" value="{{.Settings.ReconnectBanWindowSeconds}}">
					</div>
					<div>
						<div class="label">reconnect_ban_duration_seconds<div class="label-note">Reconnect ban duration (seconds) once threshold is hit. Applies to new reconnect events immediately.</div></div>
						<input name="reconnect_ban_duration_seconds" type="number" min="10" max="604800" class="textfield" value="{{.Settings.ReconnectBanDurationSeconds}}">
					</div>
				</div>

				<h3 style="margin:18px 0 8px 0;">Peer cleaning</h3>
				<p class="text-sm" style="margin:0 0 8px 0;">
					These options affect Bitcoin node peer hygiene only; they do not directly disconnect miners.
				</p>
				<div class="grid admin-grid">
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="peer_cleanup_enabled" value="1" {{if .Settings.PeerCleanupEnabled}}checked{{end}}><span>peer_cleanup_enabled</span></label><div class="label-note">Enable best-effort pruning of high-latency peers (applies to node-info display and warnings).</div></div>
					</div>
					<div>
						<div class="label">peer_cleanup_max_ping_ms<div class="label-note">Max peer ping (ms) above which peers are considered unhealthy.</div></div>
						<input name="peer_cleanup_max_ping_ms" type="text" class="textfield" value="{{printf "%.2f" .Settings.PeerCleanupMaxPingMs}}">
					</div>
					<div>
						<div class="label">peer_cleanup_min_peers<div class="label-note">Minimum number of peers to keep connected before pruning.</div></div>
						<input name="peer_cleanup_min_peers" type="number" class="textfield" value="{{.Settings.PeerCleanupMinPeers}}">
					</div>
				</div>

					<h3 style="margin:18px 0 8px 0;">Main config runtime</h3>
					<p class="text-sm" style="margin:0 0 8px 0;">
						Miscellaneous runtime behavior: connection timeout and submit-validation policy toggles. Logging flags are managed on the Admin Logs page.
					</p>
					<div class="grid admin-grid">
					<div>
						<div class="label">connection_timeout_seconds<div class="label-note">Miner connection idle timeout (seconds). Applies on live apply.</div></div>
						<input name="connection_timeout_seconds" type="number" min="30" max="86400" class="textfield" value="{{.Settings.ConnectionTimeoutSeconds}}">
					</div>
						<div>
							<div class="label">share_job_freshness_mode<div class="label-note">Job freshness policy for submit validation. Applies on live apply.</div></div>
						<select name="share_job_freshness_mode" class="textfield">
							<option value="0" {{if eq .Settings.ShareJobFreshnessMode 0}}selected{{end}}>0 (off)</option>
							<option value="1" {{if eq .Settings.ShareJobFreshnessMode 1}}selected{{end}}>1 (job_id)</option>
							<option value="2" {{if eq .Settings.ShareJobFreshnessMode 2}}selected{{end}}>2 (job_id+prevhash)</option>
						</select>
					</div>
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="share_check_ntime_window" value="1" {{if .Settings.ShareCheckNTimeWindow}}checked{{end}}><span>share_check_ntime_window</span></label><div class="label-note">Rejects submits when nTime is outside the configured min/max window. Applies on live apply.</div></div>
					</div>
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="share_check_version_rolling" value="1" {{if .Settings.ShareCheckVersionRolling}}checked{{end}}><span>share_check_version_rolling</span></label><div class="label-note">Rejects submits that violate negotiated version-rolling policy (mask/min-bits/version-roll enablement). Applies on live apply.</div></div>
					</div>
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="share_require_authorized_connection" value="1" {{if .Settings.ShareRequireAuthorizedConnection}}checked{{end}}><span>share_require_authorized_connection</span></label><div class="label-note">Rejects mining.submit when the connection has not authorized or the worker identity check fails. Applies on live apply.</div></div>
					</div>
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="share_check_param_format" value="1" {{if .Settings.ShareCheckParamFormat}}checked{{end}}><span>share_check_param_format</span></label><div class="label-note">Enforces strict mining.submit field length/format checks before share processing. Applies on live apply.</div></div>
					</div>
						<div>
							<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="share_require_worker_match" value="1" {{if .Settings.ShareRequireWorkerMatch}}checked{{end}}><span>share_require_worker_match</span></label><div class="label-note">Rejects mining.submit when the submitted worker name does not match the worker authorized on this connection. Applies on live apply.</div></div>
						</div>
						<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="submit_process_inline" value="1" {{if .Settings.SubmitProcessInline}}checked{{end}}><span>submit_process_inline</span></label><div class="label-note">Processes mining.submit inline on the miner connection goroutine instead of a worker queue. Usually gives materially lower submit latency; consider disabling mainly for very large pools (for example, tens of thousands of miners) where queue isolation is preferred. Applies on live apply.</div></div>
					</div>
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="share_check_duplicate" value="1" {{if .Settings.ShareCheckDuplicate}}checked{{end}}><span>share_check_duplicate</span></label><div class="label-note">Rejects duplicate submits on the same connection (same job/extranonce2/ntime/nonce/version tuple) using a recent-share cache. Adds small memory/CPU overhead per connection. Applies on live apply.</div></div>
					</div>
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="share_require_job_id" value="1" {{if .Settings.ShareRequireJobID}}checked{{end}}><span>share_require_job_id</span></label><div class="label-note">Rejects mining.submit requests with an empty job_id during basic field validation. When disabled, empty job_id falls through to normal stale-job handling. Applies on live apply.</div></div>
					</div>
					<div>
						<div class="label">extranonce2_size<div class="label-note">Per-share extranonce2 byte length for submitted shares. Applies to new connections; existing miners keep their assigned extranonce format.</div></div>
						<input name="extranonce2_size" type="number" min="1" max="8" class="textfield" value="{{.Settings.Extranonce2Size}}">
					</div>
					<div>
						<div class="label">template_extranonce2_size<div class="label-note">Template extranonce2 byte length used in generated jobs. Applies to newly generated jobs after live apply.</div></div>
						<input name="template_extranonce2_size" type="number" min="1" max="16" class="textfield" value="{{.Settings.TemplateExtraNonce2Size}}">
					</div>
					<div>
						<div class="label">job_entropy<div class="label-note">Entropy bytes added to per-job tags in coinbase. Applies to newly generated jobs after live apply.</div></div>
						<input name="job_entropy" type="number" min="0" class="textfield" value="{{.Settings.JobEntropy}}">
					</div>
					<div>
						<div class="label">coinbase_scriptsig_max_bytes<div class="label-note">Maximum allowed coinbase scriptSig size in bytes. Applies to newly generated jobs after live apply.</div></div>
						<input name="coinbase_scriptsig_max_bytes" type="number" min="2" class="textfield" value="{{.Settings.CoinbaseScriptSigMaxBytes}}">
					</div>
				</div>

				<h3 style="margin:18px 0 8px 0;">Runtime</h3>
				<p class="text-sm" style="margin:0 0 8px 0;">
					Performance and protocol runtime controls for notifications, hashrate smoothing, nTime slack, and version-rolling checks.
				</p>
				<div class="grid admin-grid">
					<div>
						<div class="label">discord_worker_notify_threshold_seconds<div class="label-note">Minimum seconds online/offline before Discord worker notifications are sent. Applies on live apply.</div></div>
						<input name="discord_worker_notify_threshold_seconds" type="number" min="0" max="86400" class="textfield" value="{{.Settings.DiscordWorkerNotifyThresholdSeconds}}">
					</div>
					<div>
						<div class="label">hashrate_ema_tau_seconds<div class="label-note">EMA time constant for hashrate smoothing (seconds). Applies on live apply.</div></div>
						<input name="hashrate_ema_tau_seconds" type="number" min="1" step="1" class="textfield" value="{{printf "%.0f" .Settings.HashrateEMATauSeconds}}">
					</div>
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="hashrate_cumulative_enabled" value="1" {{if .Settings.HashrateCumulativeEnabled}}checked{{end}}><span>hashrate_cumulative_enabled</span></label><div class="label-note">Blend EMA with cumulative hashrate (long-horizon) for per-worker display. Applies on live apply.</div></div>
					</div>
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="hashrate_recent_cumulative_enabled" value="1" {{if .Settings.HashrateRecentCumulativeEnabled}}checked{{end}}><span>hashrate_recent_cumulative_enabled</span></label><div class="label-note">Allow short-window cumulative (vardiff window) to influence per-worker display. Applies on live apply.</div></div>
					</div>
					<div>
						<div class="label">share_ntime_max_forward_seconds<div class="label-note">Maximum seconds a miner can roll nTime forward. Applies on live apply.</div></div>
						<input name="share_ntime_max_forward_seconds" type="number" min="1" class="textfield" value="{{.Settings.ShareNTimeMaxForwardSeconds}}">
					</div>
					<div>
						<div class="label">min_version_bits<div class="label-note">Minimum number of version-rolling bits required when version mask is active. Applies on live apply.</div></div>
						<input name="min_version_bits" type="number" min="0" class="textfield" value="{{.Settings.MinVersionBits}}">
					</div>
					<div>
						<div class="label"><label class="label" style="font-weight:500;margin:0;display:flex;align-items:center;gap:8px;"><input type="checkbox" name="share_allow_degraded_version_bits" value="1" {{if .Settings.ShareAllowDegradedVersionBits}}checked{{end}}><span>share_allow_degraded_version_bits</span></label><div class="label-note">Allow version rolling even when miners advertise fewer bits than required. Applies on live apply.</div></div>
					</div>
				</div>

				<details class="admin-protected">
					<summary class="admin-protected-summary">
						<span class="admin-protected-title">Protected (config-file only)</span>
						<span class="admin-protected-hint">Click to expand</span>
					</summary>
					<p class="text-sm" style="margin:8px 0 8px 0;">
						Read-only values shown here for reference. Update them in config files and reboot.
					</p>
					<div class="grid admin-grid">
					<div>
						<div class="label">Brand name {{template "sensitive" .}}<div class="label-note">Shown across the status UI as the pool name.</div></div>
						<input name="status_brand_name" type="text" class="textfield" value="{{.Settings.StatusBrandName}}" disabled>
					</div>
					<div>
						<div class="label">Brand domain {{template "sensitive" .}}<div class="label-note">The hostname shown in the UI and used for copy/paste Stratum URLs (usually your public domain).</div></div>
						<input name="status_brand_domain" type="text" class="textfield" value="{{.Settings.StatusBrandDomain}}" disabled>
					</div>
					<div>
						<div class="label">Server location {{template "sensitive" .}}<div class="label-note">Shown on the status UI (optional).</div></div>
						<input name="server_location" type="text" class="textfield" value="{{.Settings.ServerLocation}}" disabled>
					</div>
					<div>
						<div class="label">status_public_url {{template "sensitive" .}}<div class="label-note">Canonical public URL used for redirects and cookies (include https:// and host). Leave blank to auto-detect.</div></div>
						<input name="status_public_url" type="text" class="textfield" value="{{.Settings.StatusPublicURL}}" disabled>
					</div>
					<div>
						<div class="label">payout_address {{template "sensitive" .}}<div class="label-note">Pool payout address used for coinbase outputs.</div></div>
						<input name="payout_address" type="text" class="textfield" value="{{.Settings.PayoutAddress}}" disabled>
					</div>
					<div>
						<div class="label">pool_fee_percent {{template "sensitive" .}}<div class="label-note">Pool fee percent used when constructing coinbase payouts.</div></div>
						<input name="pool_fee_percent" type="text" class="textfield" value="{{printf "%.4f" .Settings.PoolFeePercent}}" disabled>
					</div>
					<div>
						<div class="label">operator_donation_percent {{template "sensitive" .}}<div class="label-note">Operator donation percent used when enabled.</div></div>
						<input name="operator_donation_percent" type="text" class="textfield" value="{{printf "%.4f" .Settings.OperatorDonationPercent}}" disabled>
					</div>
					<div>
						<div class="label">Operator donation name {{template "sensitive" .}}<div class="label-note">Donation name shown on the status page when operator donation is enabled.</div></div>
						<input name="operator_donation_name" type="text" class="textfield" value="{{.Settings.OperatorDonationName}}" disabled>
					</div>
					<div>
						<div class="label">Operator donation URL {{template "sensitive" .}}<div class="label-note">Donation link shown on the status page when operator donation is enabled.</div></div>
						<input name="operator_donation_url" type="text" class="textfield" value="{{.Settings.OperatorDonationURL}}" disabled>
					</div>
					<div>
						<div class="label">pool_entropy {{template "sensitive" .}}<div class="label-note">Pool entropy tag (used in coinbase).</div></div>
						<input name="pool_entropy" type="text" class="textfield" value="{{.Settings.PoolEntropy}}" disabled>
					</div>
					<div>
						<div class="label">pool_tag_prefix {{template "sensitive" .}}<div class="label-note">Pool tag prefix for coinbase data.</div></div>
						<input name="pool_tag_prefix" type="text" class="textfield" value="{{.Settings.PoolTagPrefix}}" disabled>
					</div>
					<div>
						<div class="label">pool_listen {{template "restart-required" .}} {{template "sensitive" .}}<div class="label-note">Stratum TCP listener for miners.</div></div>
						<input name="pool_listen" type="text" class="textfield" value="{{.Settings.ListenAddr}}" disabled>
					</div>
					<div>
						<div class="label">status_listen (http) {{template "restart-required" .}} {{template "sensitive" .}}<div class="label-note">Status UI HTTP listener. When TLS is enabled, HTTP redirects to HTTPS.</div></div>
						<input name="status_listen" type="text" class="textfield" value="{{.Settings.StatusAddr}}" disabled>
					</div>
					<div>
						<div class="label">status_tls_listen (https) {{template "restart-required" .}} {{template "sensitive" .}}<div class="label-note">Status UI HTTPS listener.</div></div>
						<input name="status_tls_listen" type="text" class="textfield" value="{{.Settings.StatusTLSAddr}}" disabled>
					</div>
					<div>
						<div class="label">stratum_tls_listen {{template "restart-required" .}} {{template "sensitive" .}}<div class="label-note">Optional Stratum TLS listener for miners that support TLS.</div></div>
						<input name="stratum_tls_listen" type="text" class="textfield" value="{{.Settings.StratumTLSListen}}" disabled>
					</div>
					</div>
				</details>
				</details>

				<label class="label" for="apply-password" style="margin-top:16px;">Admin password (required)</label>
				<p class="text-sm" style="margin:4px 0 0 0;color:rgba(255,255,255,0.72);">
					This confirms the change; it does not set or change your password.
				</p>
				<input id="apply-password" name="password" type="password" class="textfield" autocomplete="current-password" placeholder="Enter admin.toml password" required>
				<button class="btn" type="submit" style="margin-top:12px;">Apply live settings</button>
			</form>
		</div>

		<div class="card">
			<div class="label">Save to disk</div>
			<p class="text-sm" style="margin:4px 0 10px 0;">
				Force-write the current in-memory config to <span class="mono">config.toml</span>, <span class="mono">services.toml</span>, <span class="mono">policy.toml</span>, and <span class="mono">tuning.toml</span>.
				This overwrites files on disk; use with care.
			</p>
			{{if .AdminPersistError}}
			<p class="text-sm" style="color:#f88d8d;">{{.AdminPersistError}}</p>
			{{end}}
			<form method="post" action="/admin/persist">
				<label class="label" for="persist-password">Admin password (required)</label>
				<input id="persist-password" name="password" type="password" class="textfield" autocomplete="current-password" placeholder="Enter admin.toml password" required>
				<label class="label" for="persist-confirm">Confirmation</label>
				<input id="persist-confirm" name="confirm" type="text" class="textfield" placeholder="Type SAVE" required>
				<button class="btn btn-secondary" type="submit" style="margin-top:12px;">Save split config files</button>
			</form>
		</div>

		<div class="card">
			<div class="label">Reload UI assets</div>
			<p class="text-sm" style="margin:4px 0 10px 0;">
				Reloads HTML templates and cached static files from disk without restarting the pool.
			</p>
			{{if .AdminReloadError}}
			<p class="text-sm" style="color:#f88d8d;">{{.AdminReloadError}}</p>
			{{end}}
			<form method="post" action="/admin/reload-ui">
				<label class="label" for="reload-password">Admin password (required)</label>
				<input id="reload-password" name="password" type="password" class="textfield" autocomplete="current-password" placeholder="Enter admin.toml password" required>
				<label class="label" for="reload-confirm">Confirmation</label>
				<input id="reload-confirm" name="confirm" type="text" class="textfield" placeholder="Type RELOAD" required>
				<button class="btn btn-secondary" type="submit" style="margin-top:12px;">Reload UI assets</button>
			</form>
		</div>

		<div class="card">
			<div class="label">Reboot the pool</div>
			<p class="text-sm" style="margin:4px 0 10px 0;">This sends SIGTERM to goPool. Make sure your supervisor restarts it.</p>
			{{if .AdminRebootError}}
			<p class="text-sm" style="color:#f88d8d;">{{.AdminRebootError}}</p>
			{{end}}
			<form method="post" action="/admin/reboot">
				<label class="label" for="reboot-password">Admin password (required)</label>
				<input id="reboot-password" name="password" type="password" class="textfield" autocomplete="current-password" placeholder="Enter admin.toml password" required>
				<label class="label" for="reboot-confirm">Confirmation</label>
				<input id="reboot-confirm" name="confirm" type="text" class="textfield" placeholder="Type REBOOT" required>
				<button class="btn btn-secondary" type="submit" style="margin-top:12px;">Reboot now</button>
			</form>
		</div>

		<div class="card">
			<form method="post" action="/admin/logout">
				<button class="btn btn-secondary" type="submit">Sign out</button>
			</form>
		</div>
		{{end}}
	{{template "footer" .}}
	</main>
</body>
</html>
